{% extends "index.html" %}
{% load i18n %}
{% load staticfiles %}

{% block content %}
<style type="text/css">
.rating { font-weight: bold; }
.A { color: green; }
.B { color: yellow; }
.C { color: red; }
</style>
{% include "beta.html" %}

<div id="left" style="width:45%;float:left;clear:right;">
<h3 class="headline">{% trans "Users - Companies" %}</h3>
<ul>
    {% for u in users %}
    <li>{% trans "User" %}: {{ u.get_profile }}
        <input type="button" value="{% trans "Send memory mail" %}" onclick="send_mail([{{ u.id }}]);" />
        <ul>{% trans "Companies to rate" %}:
            {% for c in u.to_rate %}
            <li>{{ c.name }} ({% if c.last_rate %}{% trans "Last Rating" %}:
                {{ c.last_rate|date:"SHORT_DATE_FORMAT" }}{% else %}
                {% trans "Not rated yet!" %}{% endif %})</li>
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>
</div>

<div id="middle" style="width:29%;float:left;margin-left:5px;">
<h3 class="headline">{% trans "Ratings - Companies" %}</h3>
<ul>
    {% for c in companies %}
    <li class="rating {{ c.rating }}" title="{{ c.rating_note|default:"-" }}">{{ c.rating }}: {{ c.name }}</li>
    {% endfor %}
</ul>
</div>

<div id="right" style="width:24%;float:right;">
<h3 class="headline">{% trans "Stored Ratings" %}</h3>
<ul>
    {% for r in old_ratings %}
    <li><a href="{{ r.pdf.url }}">{{ r.category }} {{ r.generated|date:"Y/m" }}</a></li>
    {% endfor %}
</ul>
</div>

<p style="clear:both;padding-top:20px;">
    <input type="button" value="{% trans "Send memory mail to all" %}" onclick="send_mail([{{ uids|join:", " }}]);" />
</p>

<script type="text/javascript">
function send_mail(uids) {
    post_data = {'uids': uids};
    $.post('{% url "orders-api-mail" %}', {'_JSON_': JSON.stringify(post_data)},
        function(ret_data) {
            alert(ret_data['msg']);
        }
    );
}
</script>
{% endblock %}
