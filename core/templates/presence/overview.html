{% extends "index.html" %}
{% load url from future %}
{% load i18n %}

{% block content %}
<div class="row-fluid">
    <div class="span8 offset1 centered">
        <div class="alert">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            {% trans "The first call of a list can take some time!" %}
        </div>
    </div>
</div>
<div class="row-fluid">
    <div class="span8 offset1 centered">
        {% for j in jobs %}
        <a class="btn btn-mini btn-info" href="#{{ j }}">{{ j }}</a>
        {% endfor %}
    </div>
</div>

{% for n, gr in groups %}
<h3 style="margin-top:50px;">
    <a id="{{ n }}">{{ n }}</a>
    <a class="btn btn-primary" href="{% url "core-presence-printouts" n %}">
        {% trans "Old lists" %}
    </a>
</h3>
<table class="dTable table table-striped table-bordered">
  <thead>
    <tr>
        <th>{% trans "Group" %}</th>
        <th>{% trans "Show list by date" %}</th>
        <th>{% trans "Finished lists / Information" %}</th>
    </tr>
  </thead>
  <tbody>
    {% for g in gr %}
    <tr>
        <td><strong>{{ g }}</strong></td>
        <td>
          <form action="{% url "core-presence-group" g.id %}" method="post" onsubmit="return disable_btn('btn_{{ g.id }}');">
            {% csrf_token %}
            {% trans "From" %} <input type="text" class="dateWidget" name="start" size="16" />
            {% trans "to" %} <input type="text" class="dateWidget" name="end" size="16" />
            <input class="btn" type="submit" id="btn_{{ g.id }}" value="{% trans "Show" %}" />
          </form>
        </td>
        <td>
            {% if g.pdfs %}
            {% for p in g.pdfs %}<a href="{{ p.pdf.url }}">{{ p.date.month }}-{{ p.company.short_name }}</a> {% endfor %}
            / {% endif %}{% trans "Presence days for month" %} {{ month }}: {{ g.pdays }}
        </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% empty %}
<h3>{% trans "No groups found." %}</h3>
{% endfor %}

{% endblock %}

{% block additional_js %}
<script>
$(function() {
    $('.dateWidget').each(function() {
        var dp = $(this);
        dp.datepicker({
            'format': 'dd.mm.yyyy',
            'weekStart': 1,
            'viewMode': 'years'
        });
    });
    datatable_options['bPaginate'] = false;
    $('.dTable').each(function() {
        var t = $(this);
        t.dataTable(datatable_options);
    });
});

function disable_btn(btn_id) {
    $('#'+btn_id).attr('disabled', 'disabled');
    return true;
}
</script>

{% endblock %}
